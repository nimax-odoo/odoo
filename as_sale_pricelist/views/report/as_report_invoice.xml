<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="as_sale_pricelist.header_invoice_nimax">
        <t t-foreach="docs" t-as="o">
            <div class="header">
                <t t-if="not o.l10n_mx_edi_cfdi_uuid">
                    <!-- due to HTML preview for device responsive -->
                    <button t-attf-class="btn-danger #{'btn' if report_type != 'html' else ''}">
                        <h1>A signature of this invoice is required, but it is not signed.</h1>
                    </button>
                </t>
                <t t-if="o.l10n_mx_edi_cfdi_uuid">
                    <!--New global variables-->
                    <t t-set="xml" t-value="o.l10n_mx_edi_get_xml_etree()" />
                    <t t-set="tfd" t-value="o.l10n_mx_edi_get_tfd_etree(xml)" />
                    <t t-set="tfd_original_string" t-value="o._get_l10n_mx_edi_cadena()" />
                    <t t-set="external" t-value="o.l10n_mx_edi_get_et_etree(xml)" />
                </t>
                <style type="text/css">
                    body {
                        font-family: 'Helvetica Neue LT Std' !important;
                    }

                    .letra {
                        font-family: 'Helvetica Neue LT Std' !important;
                        font-size: 12px !important;
                        margin: 0px;
                    }

                    .letrafont {
                        font-family: 'Helvetica Neue LT Std' !important;
                        font-size: 12px !important;
                        margin: 0px;
                        color: rgb(82, 86, 89);
                    }

                    .letrablue {
                        font-family: 'Helvetica Neue LT Std' !important;
                        font-size: 12px !important;
                        margin: 0px;
                        color: rgb(47 94 130);
                    }

                    .class {
                        text-align: left:
                    }

                    .content {
                        background: rgb(82, 86, 89);
                        padding: 5px;
                        color: #fff;
                        border: 2px solid rgb(82, 86, 89);
                    }

                    .content2 {
                        background: #fff;
                        color: red;
                        padding: 5px;
                        border: 2px solid rgb(82, 86, 89);
                    }
                </style>
                <div class="row mt0 mb0 as_header">

                    <div class="col-4" style="text-align:left; margin-bottom:10px;font-size:15px;">
                        <t t-if="o.company_id.logo">
                            <img t-att-src="image_data_uri(o.company_id.logo)" style="height: 85px; width:100%" />
                            <br />
                        </t>
                        <div class="letra">
                            <b>
                                <span t-esc="o.company_id.name" />
                            </b>
                        </div>
                        <span t-esc="o.company_id.vat" class="letra" /><br />
                        <span t-esc="o.company_id.street" class="letra" />, <span
                            t-esc="o.company_id.l10n_mx_edi_locality" class="letra" /> <span
                            t-esc="o.company_id.state_id.name" class="letra" />, C.P. <span t-esc="o.company_id.zip"
                            class="letra" /><br />
                        <span t-esc="o.company_id.email" />

                    </div>
                    <div class="col-4" style="text-align:left;" name='as_titulo'>
                        <table style="width:100%;padding:10px;">
                            <tr class="content">
                                <td><b>FACTURA</b></td>
                                <td class="content2"><b> <span t-esc="o.name" /></b></td>
                            </tr>
                        </table>
                        <br />
                        <br />
                        <div class="letra">
                            <b>
                                <span t-esc="o.partner_shipping_id.name" />
                            </b>
                        </div>
                        <span t-esc="o.partner_shipping_id.vat" class="letra" /><br />
                        <span t-esc="o.partner_shipping_id.street_name" class="letra" />, <span
                            t-esc="o.partner_shipping_id.city" class="letra" /> <span
                            t-esc="o.partner_shipping_id.state_id.name" class="letra" />, C.P. <span
                            t-esc="o.partner_shipping_id.zip" class="letra" /><br />
                        <span t-esc="o.partner_shipping_id.email" />
                    </div>
                    <div class="col-4" style="text-align:left; ">
                        <p class="letrafont"><b>Folio Fiscal</b></p>
                        <p class="letrafont"><span t-esc="o.l10n_mx_edi_cfdi_uuid" /></p>
                        <p class="letrafont"><b>No. de Serie del CSD del SAT</b></p>
                        <p class="letrafont"><span t-esc="tfd.get('NoCertificadoSAT')" /></p>
                        <p class="letrafont"><b>Fecha y Hora de Certificación</b></p>
                        <p class="letrafont"><span t-esc="tfd.get('FechaTimbrado', '').replace('T', ' ')" /></p>
                        <p class="letrafont"><b>No. de Serie del CSD del Emisor</b></p>
                        <p class="letrafont"><span t-esc="xml.get('noCertificado', xml.get('NoCertificado'))" /></p>
                        <p class="letrafont"><b>Fecha y Hora de Emisión</b></p>
                        <p class="letrafont"><span t-esc="xml.get('fecha', xml.get('Fecha', '')).replace('T', ' ')" />
                        </p>
                    </div>

                </div>

            </div>
        </t>
    </template>
    <template id="as_sale_pricelist.footer_invoice_nimax">

        <div class="footer">
            <t t-if="not o.l10n_mx_edi_cfdi_uuid">
                <!-- due to HTML preview for device responsive -->
                <button t-attf-class="btn-danger #{'btn' if report_type != 'html' else ''}">
                    <h1>A signature of this invoice is required, but it is not signed.</h1>
                </button>
            </t>
            <t t-if="o.l10n_mx_edi_cfdi_uuid">
                <!--New global variables-->
                <t t-set="xml" t-value="o.l10n_mx_edi_get_xml_etree()" />
                <t t-set="tfd" t-value="o.l10n_mx_edi_get_tfd_etree(xml)" />
                <t t-set="tfd_original_string" t-value="o._get_l10n_mx_edi_cadena()" />
                <t t-set="external" t-value="o.l10n_mx_edi_get_et_etree(xml)" />
            </t>
            <style>
                .parrafo {
                    font-size: 11px;
                    text-align: justify;
                    line-height: 18px;
                    background: #ccc;
                    padding: 5px
                }
                .barcode {
                    float: none;

                    img {
                        height: 100%;
                        width: 180px;
                    }
                }
            </style>
            <div class="row mt0 mb0">
                <div class="col-12">
                    <b>NOTA IMPORTANTE:</b> No hay devoluciones después de 5 días naturales. No hay devoluciones en
                    refacciones, consumibles, cabezales de impresión y software. <b>TODA DEVOLUCIÓN AUTORIZADA
                        TENDRÁ UN CARGO
                        DE 20% SOBRE EL PRECIO BRUTO FACTURADO </b> y se realizará a través de nota de crédito.
                    Debo y pagaré incondicionalmente por el presente <b>PAGARÉ a TECNOLOGÍA NIMAX S.A. DE C.V.,</b>
                    la cantidad total de esta factura que corresponde las mercancías detalladas en el presente
                    documento en el domicilio
                    de la empresa, obligándome a pagar para el caso de mora un interés del 1% mensual durante todo
                    el tiempo que permanezca insoluto.
                </div>
            </div>
            
                    <t t-set="sello" t-value="xml.get('Sello', 'No identificado')[-8:]" />
                    <img alt="Barcode" t-att-src="'/report/barcode/?type=QR&amp;value=%s' % quote_plus(
                            'https://verificacfdi.facturaelectronica.sat.gob.mx/default.aspx?' + keep_query(
                                re=o.l10n_mx_edi_cfdi_supplier_rfc, rr=o.l10n_mx_edi_cfdi_customer_rfc,
                                tt=o.l10n_mx_edi_cfdi_amount, id=o.l10n_mx_edi_cfdi_uuid)
                                + '&amp;fe=%s' % quote_plus(
                                    sello, 'utf-8', 'strict', '=/').replace('%2B', '+'))" style="width:90px;height:90px;" />
            <div class="row mt0 mb0">
                <div class="col-2 barcode" id='complement1'>

                    <t t-set="sello" t-value="xml.get('Sello', 'No identificado')[-8:]" />
                    <img alt="Barcode" t-att-src="'/report/barcode/?type=QR&amp;value=%s' % quote_plus(
                            'https://verificacfdi.facturaelectronica.sat.gob.mx/default.aspx?' + keep_query(
                                re=o.l10n_mx_edi_cfdi_supplier_rfc, rr=o.l10n_mx_edi_cfdi_customer_rfc,
                                tt=o.l10n_mx_edi_cfdi_amount, id=o.l10n_mx_edi_cfdi_uuid)
                                + '&amp;fe=%s' % quote_plus(
                                    sello, 'utf-8', 'strict', '=/').replace('%2B', '+'))" style="width:90px;height:90px;" />

                </div>
            </div>
            <div class="col-10" id='complement3'>
                <div class="digital-stamp" style="text-align:left !important;">
                    <span>Datos del Timbrado Fiscal</span>
                </div>
                <div class="digital-stamp-content">
                    <b>Sello del CFDi:</b><br />
                    <span t-esc="xml.get('sello', xml.get('Sello', 'No identificado'))" />
                </div>

                <div class="digital-stamp-content">
                    <b>Sello del SAT:</b><br />
                    <span t-esc="tfd.get('selloSAT', tfd.get('SelloSAT', 'No identificado'))" />
                </div>

                <div class="digital-stamp-content">
                    <b>Folio Fiscal:</b> <span t-esc="tfd.get('UUID')" /> | <b>No. de serie de certificado
                        SAT:</b>: <span t-esc="tfd.get('NoCertificadoSAT')" /> | <b>Fecha de Certificacion:</b>
                    <span t-esc="xml.get('fecha', xml.get('Fecha', '')).replace('T', ' ')" />
                </div>

                <div class="row mt0 mb0">
                    <div class="col-12">
                        <b> <span t-esc="o.company_id.name" /></b> | <p style="color:blue">RFC: <span
                                t-esc="o.company_id.vat" class="letra" /> | <p icon="fa-street"> <span
                                    t-esc="o.company_id.street" class="letra" />, <span
                                    t-esc="o.company_id.l10n_mx_edi_locality" class="letra" /> <span
                                    t-esc="o.company_id.state_id.name" class="letra" /></p> | <span icon="fa-phone"
                                t-esc="o.company_id.phone" /></p>
                    </div>
                </div>
                <br /> <b>Pagina </b>
                <label class="page" />/<label class="topage" />
            </div>
        </div>

    </template>


    <template id="gst_report_invoice_document_ahorasoft_inherit" inherit_id="account.report_invoice_document">

        <xpath expr="//t[@t-call='web.external_layout']" position="attributes">
            <attribute name="t-call">web.internal_layout</attribute>
        </xpath>
        <xpath expr="//div[@class='page']/h2" position="replace">
        </xpath>
        <xpath expr="//div[@id='informations']" position="replace">
            <div id="informations" class="row mt0 mb0">
                <style type="text/css">
                    body {
                        font-family: 'Helvetica Neue LT Std' !important;
                    }

                    .letra {
                        font-family: 'Helvetica Neue LT Std' !important;
                        font-size: 12px !important;
                        margin: 0px;
                    }

                    .letrafont {
                        font-family: 'Helvetica Neue LT Std' !important;
                        font-size: 12px !important;
                        margin: 0px;
                        color: rgb(82, 86, 89);
                    }

                    .letrablue {
                        font-family: 'Helvetica Neue LT Std' !important;
                        font-size: 12px !important;
                        margin: 0px;
                        color: rgb(47 94 130);
                    }

                    .class {
                        text-align: left:
                    }

                    .content {
                        background: rgb(82, 86, 89);
                        padding: 5px;
                        color: #fff;
                    }

                    .content2 {
                        background: #fff;
                        color: red;
                        padding: 5px;
                        border: 2px solid rgb(82, 86, 89);
                    }
                </style>
                <div class="col-3" t-if="o.invoice_date" name="invoice_date">
                    <b class='letrablue'>FECHA DE FACTURA: </b>
                    <p t-field="o.invoice_date" />
                </div>
                <div class="col-3" t-if="o.invoice_date_due and o.type == 'out_invoice' and o.state == 'posted'"
                    name="due_date">
                    <b class='letrablue'>FECHA DE VENCIMIENTO: </b>
                    <p t-field="o.invoice_date_due" />
                </div>
                <div class="col-3" t-if="o.invoice_origin" name="origin">
                    <b class='letrablue'>ORIGEN:</b>
                    <p t-field="o.invoice_origin" />
                </div>
                <div class="col-3" t-if="o.invoice_origin" name="origin">
                    <b class='letrablue'>ORDEN DE COMPRA:</b>
                    <p t-esc="o.get_referencia_pedido()" />
                </div>

            </div>
        </xpath>

        <xpath expr="//table[@name='invoice_line_table']" position="replace">
            <style type="text/css">
                body {
                    font-family: 'Helvetica Neue LT Std' !important;
                }

                .letra {
                    font-family: 'Helvetica Neue LT Std' !important;
                    font-size: 12px !important;
                    margin: 0px;
                }

                .letrafont {
                    font-family: 'Helvetica Neue LT Std' !important;
                    font-size: 12px !important;
                    margin: 0px;
                    color: rgb(47 94 130);
                    background: #fff !important;
                }

                .content {
                    font-family: 'Helvetica Neue LT Std' !important;
                    font-size: 10px !important;
                    color: rgb(82, 86, 89);

                }

                .header_table {
                    background: rgb(82, 86, 89);
                    color: #fff;
                    font-size: 12px !important;
                }

                .invoice_tbody {
                    border: 2 px solid rgb(82, 86, 89);
                    font-size: 11px !important;
                }

                .text2 {
                    font-family: 'Helvetica Neue LT Std' !important;
                    font-size: 12px !important;
                    margin: 0px;
                    color: rgb(47 94 130);
                }

                .class {
                    text-align: left:
                }

                .content2 {
                    background: #fff;
                    color: red;
                    padding: 5px;
                    border: 2px solid rgb(82, 86, 89);
                }

                .table_info {
                    border: 2px solid #fff;
                    width: 100%;
                    font-size: 10px !important;
                }
            </style>
            <table class="table table-sm o_main_table" name="invoice_line_table">
                <thead class="header_table">
                    <tr>

                        <th name="th_mx_source" class="d-none text-left"><span>CÓDIGO SAT</span></th>
                        <th name="th_mx_parte" class="text-left"><span>SKU / NO. DE PARTE</span></th>
                        <th name="th_mx_description_mx" class="d-none text-left"><span>DESCRIPCIÓN</span></th>
                        <th name="th_mx_description_mx" class="d-none text-left"><span>DESCRIPCIÓN</span></th>
                        <th name="th_mx_quantity" class="text-center"><span>DESCRIPCIÓN</span></th>
                        <th name="th_mx_quantity" class="text-right"><span>CANT</span></th>
                        <th name="th_mx_price_unit" class="text-right"><span>PRECIO U.</span></th>
                        <th name="th_mx_import" class="text-right"><span>IMPORTE</span></th>
                    </tr>
                </thead>
                <tbody class="invoice_tbody">
                    <t t-set="current_subtotal" t-value="0" />

                    <t t-foreach="o.invoice_line_ids" t-as="line">

                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal"
                            groups="account.group_show_line_subtotals_tax_excluded" />
                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_total"
                            groups="account.group_show_line_subtotals_tax_included" />

                        <tr
                            t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                            <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                <td name="as_sat_code"><span t-if="line.product_id.l10n_mx_edi_code_sat_id.code"
                                        t-field="line.product_id.l10n_mx_edi_code_sat_id.code" /></td>
                                <td name="as_sku_numero"><span t-if="line.product_id.x_studio_sku_no_de_parte"
                                        t-field="line.product_id.x_studio_sku_no_de_parte" /></td>
                                <td name="account_invoice_line_name">
                                    <span t-field="line.name" /><br />
                                    <span t-esc="o.get_product_lot(line.product_id.id)" />
                                    <b><span t-field="line.l10n_mx_edi_customs_number" /></b>
                                    <br />
                                    <table class="table_info" name="infor_adicional_line">
                                        <thead>
                                            <tr>
                                                <td name="as_tasa"><span class="letrafont">Tasa</span></td>
                                                <td name="as_base"><span class="letrafont">Base</span></td>
                                                <td name="as_impuesto"><span class="letrafont">Impuesto</span></td>
                                                <td name="as_impuesto"><span class="letrafont">Importe</span></td>

                                            </tr>
                                            <t t-foreach="line.tax_ids" t-as="tax">
                                                <tr>
                                                    <td name="as_tax"><span class="text2">
                                                            <t t-esc="tax.amount" /></span></td>
                                                    <td name="as_tax2"><span class="text2">
                                                            <t t-esc="line.price_unit" /></span></td>
                                                    <td name="as_tax3"><span class="text2"> S/N</span></td>
                                                    <td name="as_tax3"><span class="text2">
                                                            <t t-esc="tax.amount*line.price_unit" /></span></td>

                                                </tr>
                                            </t>
                                        </thead>
                                    </table>
                                </td>
                                <td class="text-right">
                                    <span t-field="line.quantity" />
                                    <span t-field="line.product_uom_id" groups="uom.group_uom" />
                                </td>
                                <td
                                    t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span t-field="line.price_unit" />
                                </td>
                                <!-- <td t-if="display_discount"
                                    t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span t-field="line.discount" />
                                </td>
                                <td
                                    t-attf-class="text-left {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_ids))"
                                        id="line_tax_ids" />
                                </td> -->
                                <td class="text-right o_price_total">
                                    <span t-field="line.price_subtotal"
                                        groups="account.group_show_line_subtotals_tax_excluded" />
                                    <span t-field="line.price_total"
                                        groups="account.group_show_line_subtotals_tax_included" />
                                </td>
                            </t>
                            <!-- <t t-if="line.display_type == 'line_section'">
                                <td colspan="99">
                                    <span t-field="line.name" />
                                </td>
                                <t t-set="current_section" t-value="line" />
                                <t t-set="current_subtotal" t-value="0" />
                            </t>
                            <t t-if="line.display_type == 'line_note'">
                                <td colspan="99">
                                    <span t-field="line.name" />
                                </td>
                            </t> -->
                        </tr>

                        <t
                            t-if="current_section and (line_last or o.invoice_line_ids[line_index+1].display_type == 'line_section')">
                            <tr class="is-subtotal text-right">
                                <td colspan="99">
                                    <strong class="mr16">Subtotal</strong>
                                    <span t-esc="current_subtotal"
                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}' />
                                </td>
                            </tr>
                        </t>
                    </t>
                </tbody>

            </table>
        </xpath>
        <xpath expr="//th[@name='th_mx_parte']" position="after">
            <th name="th_mx_description_mx" class="d-none text-left"><span>DESCRIPCIÓN</span></th>
        </xpath>
        <xpath expr="//table[@name='invoice_line_table']/tbody//tr[1]//td[1]" position="replace">

        </xpath>
        <xpath expr="//div[@id='total']" position="before">
            <style type="text/css">
                body {
                    font-family: 'Helvetica Neue LT Std' !important;
                    font-size: 12px !important;
                }

                .letra {
                    font-family: 'Helvetica Neue LT Std' !important;
                    font-size: 12px !important;
                    margin: 0px;
                }

                .letrafont {
                    font-family: 'Helvetica Neue LT Std' !important;
                    font-size: 12px !important;
                    margin: 0px;
                    color: rgb(47 94 130);
                    background: #fff !important;
                    text-align: center;
                }
            </style>
            <table style="width:100%">
                <thead>
                    <tr>
                        <th colspan="3" class="header_table" style="width:80%">
                            <t t-if="o.l10n_mx_edi_cfdi_uuid">
                                <p>
                                    <span t-esc="o.l10n_mx_edi_amount_to_text()" />
                                </p>
                            </t>
                        </th>
                        <th class="letrafont" style="width:10%"> Subtotal</th>
                        <th class="" style="width:10%"> <span t-field="o.amount_untaxed" /></th>
                    </tr>
                    <tr>
                        <th style="width:20%;text-align:right;">METODO DE PAGO:</th>
                        <td style="width:10%;text-align:left;">
                            <p t-esc="xml.get('formaDePago', xml.get('MetodoPago'))" />
                        </td>
                        <th style="width:30%;text-align:left;"></th>

                        <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                            <t
                                t-if="len(o.line_ids.filtered(lambda line: line.tax_line_id)) == 1 and o.amount_untaxed == amount_by_group[2]">
                                <th class="letrafont" style="width:10%"><span t-esc="amount_by_group[0]" /></th>
                                <th style="width:10%;text-align:left;">
                                    <span t-esc="amount_by_group[3]" />
                                </th>
                            </t>
                            <t t-else="">
                                <th class="letrafont" style="width:10%">
                                    <span t-esc="amount_by_group[0]" />
                                    <span>&amp;nbsp;<span>on</span>
                                        <t t-esc="amount_by_group[4]" />
                                    </span>
                                </th>
                                <th style="width:10%;text-align:left;">
                                    <span t-esc="amount_by_group[3]" />
                                </th>
                            </t>
                        </t>
                    </tr>
                    <tr>
                        <th style="width:20%;text-align:right;">FORMA DE PAGO:</th>
                        <td style="width:10%;text-align:left;"><span t-esc="o.l10n_mx_edi_payment_method_id.code" />
                        </td>
                        <th style="width:30%;text-align:left;"></th>
                        <th style="width:10%;text-align:left;"></th>
                        <th style="width:10%;text-align:left;"></th>

                    </tr>
                    <tr>
                        <th style="width:20%;text-align:right;">USO DE CFDI:</th>
                        <td style="width:10%;text-align:left;"><span t-esc="xml.Receptor.get('UsoCFDI', False)" />
                        </td>
                        <th style="width:30%;text-align:left;"></th>
                        <th style="width:30%;text-align:left;"></th>
                        <th style="width:30%;text-align:left;"></th>

                    </tr>
                    <tr>
                        <th style="width:20%;text-align:right;">VERSIÓN CFDI:</th>
                        <td style="width:10%;text-align:left;"><span t-esc="tfd.get('Version')" />
                        </td>
                        <th style="width:30%;text-align:left;">_____________________________________</th>
                        <td class="letrafont" style="width:10%"><strong>Total</strong></td>
                        <td style="width:10%"><span t-field="o.amount_total" /></td>

                    </tr>
                    <tr>
                        <th style="width:20%;text-align:right;">MONEDA:</th>
                        <td style="width:10%;text-align:left;"><span t-esc="o.currency_id.name" />
                        </td>
                        <th style="width:30%;text-align:left;">Nombre, fecha y firma de recibido</th>
                        <td class="letrafont" style="width:10%"></td>
                        <td class="letrafont" style="width:10%">
                        
                        </td>

                    </tr>
                </thead>
            </table>
        </xpath>
        <xpath expr="//div[@id='total']" position="replace">
            <div id="total" class="row">
                <div t-attf-class="#{'col-4' if report_type != 'html' else 'col-sm-7 col-md-5'} ml-auto">
                    <table class="table table-sm;page-break-inside: avoid;">
                        <tr class="border-black o_subtotal" style="">
                            <td></td>

                        </tr>

                    </table>
                </div>
            </div>
        </xpath>
        <xpath expr="//p[@name='comment']" position="replace"></xpath>
        <xpath expr="//p[@name='payment_term']" position="replace"></xpath>
        <xpath expr="//div[@id='complement']" position="replace"></xpath>

    </template>

</odoo>