<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="as_pdf_report_invoice">
            <t t-call="web.html_container">

                <t t-foreach="docs" t-as="o">
                    <div class="header">
                        <style type="text/css">
                            html {
                                margin: 0;
                            }

                            .header {
                                margin: 0px;
                                padding: 0px;
                                line-height: 17px;
                            }

                            @font-face {
                                font-family: 'Helvetica Neue';
                                src: url('/as_sale_pricelist/static/Helvetica LT 57 Condensed.ttf') format('truetype');
                                font-weight: normal;
                                font-style: normal;
                            }

                            body {
                                font-family: Helvetica Neue !important;
                            }

                            .letra {
                                font-family: Helvetica Neue !important;
                                font-size: 14px !important;
                                margin: 0px;

                            }

                            .letrafont {
                                font-family: Helvetica Neue !important;
                                font-size: 14px !important;
                                margin: 0px;
                                color: #8c8c8c;
                            }

                            .letrablue {
                                font-family: Helvetica Neue !important;
                                font-size: 13px !important;
                                margin: 0px;
                                color: #465f7a;
                            }

                            .class {
                                text-align: left:
                            }

                            .content {
                                background: #8c8c8c;
                                padding: 5px;
                                color: #fff;
                                border: 2px solid #8c8c8c;
                            }

                            .content2 {
                                background: #fff;
                                color: red;
                                padding: 5px;
                                border: 2px solid #8c8c8c;
                            }
                        </style>

                        <t t-if="o.l10n_mx_edi_cfdi_uuid">

                            <t t-set="xml" t-value="o.l10n_mx_edi_get_xml_etree()" />
                            <t t-set="tfd" t-value="o.l10n_mx_edi_get_tfd_etree(xml)" />
                            <t t-set="tfd_original_string" t-value="o._get_l10n_mx_edi_cadena()" />
                            <t t-set="external" t-value="o.l10n_mx_edi_get_et_etree(xml)" />
                        </t>
                        <div class="row mt0 mb0 as_header">

                            <div class="col-4" style="text-align:left;">
                                <t t-if="o.company_id.logo">
                                    <img t-att-src="image_data_uri(o.company_id.logo)"
                                        style="height: 55px; width:100%" />
                                    <br />
                                </t>
                                <br />
                                <div class="letra">
                                    <b>
                                        <span t-esc="o.company_id.name" />
                                    </b>
                                </div>
                                <span t-esc="o.company_id.vat" class="letra" /><br />
                                <span t-esc="o.company_id.street" class="letra" />, <span
                                    t-esc="o.company_id.l10n_mx_edi_locality" class="letra" /> <span
                                    t-esc="o.company_id.state_id.name" class="letra" />, C.P. <span
                                    t-esc="o.company_id.zip" class="letra" /><br />
                                <span t-esc="o.company_id.email" />

                            </div>
                            <div class="col-4" style="text-align:left;" name='as_titulo'>
                                <br />
                                <table style="width:100%;font-size:16px;">
                                    <tr class="content">
                                        <td style="padding:8px !important;"><b>FACTURA</b></td>
                                        <td class="content2"><b> <span t-esc="o.name" /></b></td>
                                    </tr>
                                </table>
                                <br />
                                <div class="letra">
                                    <b>
                                        <span t-esc="o.partner_shipping_id.name" />
                                    </b>
                                </div>
                                <span t-esc="o.partner_shipping_id.vat" class="letra" /><br />
                                <span t-esc="o.partner_shipping_id.street_name" class="letra" />, <span
                                    t-esc="o.partner_shipping_id.city" class="letra" /> <span
                                    t-esc="o.partner_shipping_id.state_id.name" class="letra" />, C.P. <span
                                    t-esc="o.partner_shipping_id.zip" class="letra" /><br />
                                <!-- <span class="letra" t-esc="o.partner_shipping_id.email" /> -->
                            </div>
                            <div class="col-4" style="text-align:left;">
                                <br />
                                <t t-if="o.l10n_mx_edi_cfdi_uuid">
                                    <p class="letrafont"><b>Folio Fiscal</b></p>
                                    <p class="letrafont"><span t-esc="o.l10n_mx_edi_cfdi_uuid" /></p>
                                    <p class="letrafont"><b>No. de Serie del CSD del SAT</b></p>
                                    <p class="letrafont"><span t-esc="tfd.get('NoCertificadoSAT')" /></p>
                                    <p class="letrafont"><b>Fecha y Hora de Certificación</b></p>
                                    <p class="letrafont"><span t-esc="tfd.get('FechaTimbrado', '').replace('T', ' ')" />
                                    </p>
                                    <p class="letrafont"><b>No. de Serie del CSD del Emisor</b></p>
                                    <p class="letrafont"><span t-esc="xml.get('NoCertificado')" />
                                    </p>
                                    <p class="letrafont"><b>Fecha y Hora de Emisión</b></p>
                                    <p class="letrafont"><span
                                            t-esc="xml.get('fecha', xml.get('Fecha', '')).replace('T', ' ')" />
                                    </p>
                                </t>

                            </div>

                        </div>
                        <br />
                        <table>
                            <thead>
                                <tr>
                                    <td style="width:30%"><b class='letrablue'>FECHA DE FACTURA: </b>
                                        <span class="letra" t-field="o.invoice_date" />
                                        </td>
                                
                                <td style="width:35%">
                                    <div t-if="o.invoice_date_due and o.type == 'out_invoice' and o.state == 'posted'"
                                        name="due_date">
                                        <b class='letrablue'>FECHA DE VENCIMIENTO: </b>
                                        <span class="letra" t-field="o.invoice_date_due" />
                                    </div>
                                </td>
                                <td style="width:18%"> <b class='letrablue'>ORIGEN:</b>
                                    <span class="letra" t-field="o.invoice_origin" />
                                </td>
                                <td style="width:25%"> <b class='letrablue'>ORDEN DE COMPRA:</b>
                                    <span class="letra" t-esc="o.get_referencia_pedido()" />
                                </td>
                                </tr>
                            </thead>
                        </table>
                        <!-- <div id="informations" class="row mt0 mb0">
                            <div class="col-3" t-if="o.invoice_date" name="invoice_date">
                                <b class='letrablue'>FECHA DE FACTURA: </b>
                                <span class="letra" t-field="o.invoice_date" />
                            </div>
                            <div class="col-4"
                                t-if="o.invoice_date_due and o.type == 'out_invoice' and o.state == 'posted'"
                                name="due_date">
                                <b class='letrablue'>FECHA DE VENCIMIENTO: </b>
                                <span class="letra" t-field="o.invoice_date_due" />
                            </div>
                            <div class="col-2" t-if="o.invoice_origin" name="origin" style="width:200px">
                                <b class='letrablue'>ORIGEN:</b>
                                <span class="letra" t-field="o.invoice_origin" />
                            </div>
                            <div class="col-3" t-if="o.invoice_origin" name="origin">
                                <b class='letrablue'>ORDEN DE COMPRA:</b>
                                <span class="letra" t-esc="o.get_referencia_pedido()" />
                            </div>

                        </div> -->

                    </div>
                    <t t-call="web.internal_layout">
                        <t t-if="o.l10n_mx_edi_cfdi_uuid">

                            <t t-set="xml" t-value="o.l10n_mx_edi_get_xml_etree()" />
                            <t t-set="tfd" t-value="o.l10n_mx_edi_get_tfd_etree(xml)" />
                            <t t-set="tfd_original_string" t-value="o._get_l10n_mx_edi_cadena()" />
                            <t t-set="external" t-value="o.l10n_mx_edi_get_et_etree(xml)" />
                        </t>
                        <div class="page">
                            <style type="text/css">
                                html {
                                    margin: 0;
                                }

                                body {
                                    font-family: Helvetica Neue !important;
                                }

                                @font-face {
                                    font-family: 'Helvetica Neue';
                                    src: url('/as_sale_pricelist/static/Helvetica LT 57 Condensed.ttf') format('truetype');
                                    font-weight: normal;
                                    font-style: normal;
                                }

                                .letra {
                                    font-family: Helvetica Neue !important;
                                    font-size: 13px !important;
                                    margin: 0px;
                                }

                                .letrafont {
                                    font-family: Helvetica Neue !important;
                                    font-size: 13px !important;
                                    margin: 0px;
                                    color: #8c8c8c;
                                }

                                .letrablue {
                                    font-family: Helvetica Neue !important;
                                    font-size: 13px !important;
                                    margin: 0px;
                                    color: #465f7a !important;
                                }

                                .class {
                                    text-align: left:
                                }

                                .content {
                                    background: #8c8c8c;
                                    padding: 5px;
                                    color: #fff;
                                }

                                .content2 {
                                    background: #fff;
                                    color: red;
                                    padding: 5px;
                                    border: 2px solid #8c8c8c;
                                }

                                body {
                                    font-family: Helvetica Neue !important;
                                }

                                .letra {
                                    font-family: Helvetica Neue !important;
                                    font-size: 13px !important;

                                }

                                .letrafont {
                                    font-family: Helvetica Neue !important;
                                    font-size: 13px !important;

                                    color: #465f7a;
                                    background: #fff !important;
                                }

                                .content {
                                    font-family: Helvetica Neue !important;
                                    font-size: 10px !important;
                                    color: #8c8c8c;

                                }

                                .header_table {
                                    background: #8c8c8c;
                                    color: #fff;
                                    font-size: 16px !important;
                                }

                                .invoice_tbody {
                                    border: 2 px solid #8c8c8c;
                                    font-size: 11px !important;
                                }

                                .text2 {
                                    font-family: Helvetica Neue !important;
                                    font-size: 13px !important;

                                    color: #465f7a;
                                }

                                .class {
                                    text-align: left:
                                }

                                .content2 {
                                    background: #fff;
                                    color: red;
                                    padding: 5px;
                                    border: 2px solid #8c8c8c;
                                }

                                .table_info {
                                    border: 2px solid #fff;
                                    width: 100%;
                                    font-size: 10px !important;
                                }

                                .invoice_tbody tr .border {
                                    border-left: 2px solid #8c8c8c !important;
                                    border-right: 2px solid #8c8c8c !important;
                                    font-size: 13px !important;
                                }

                                .parrafo2 {
                                    font-size: 12px;
                                    text-align: justify;
                                    line-height: 18px;
                                    background: #ccc;
                                    padding: 5px;
                                    line-height: 15px;
                                }

                                @font-face {
                                    font-family: 'Helvetica Neue';
                                    src: url('/as_sale_pricelist/static/Helvetica LT 57 Condensed.ttf') format('truetype');
                                    font-weight: normal;
                                    font-style: normal;
                                }

                                .parrafo22 {
                                    font-size: 12px;
                                    text-align: justify;
                                    line-height: 15px;
                                    width: 700px;
                                }

                                body {
                                    font-family: Helvetica Neue !important;
                                }


                                .class {
                                    text-align: left:
                                }
                            </style>

                            <table class="table table-sm o_main_table" name="invoice_line_table">
                                <thead class="header_table">
                                    <tr>

                                        <th name="th_mx_parte" class="text-left"><span>SKU / NO. DE PARTE</span></th>
                                        <th name="th_mx_source" class="text-left"><span>CÓDIGO SAT</span></th>
                                        <th name="th_mx_quantity" class="text-center"><span>DESCRIPCIÓN</span></th>
                                        <th name="th_mx_quantity" class="text-right"><span>CANT</span></th>
                                        <th name="th_mx_price_unit" class="text-right"><span>PRECIO U.</span></th>
                                        <th name="th_mx_import" class="text-right"><span>IMPORTE</span></th>
                                    </tr>
                                </thead>
                                <tbody class="invoice_tbody">
                                    <t t-set="current_subtotal" t-value="0" />

                                    <t t-foreach="o.invoice_line_ids" t-as="line">

                                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal"
                                            groups="account.group_show_line_subtotals_tax_excluded" />
                                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_total"
                                            groups="account.group_show_line_subtotals_tax_included" />

                                        <tr
                                            t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                            <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                                <td class='border' name="as_sku_numero"><span
                                                        t-if="line.product_id.x_studio_sku_no_de_parte"
                                                        t-field="line.product_id.x_studio_sku_no_de_parte" /></td>
                                                <td class='border' name="as_sat_code"><span
                                                        t-if="line.product_id.l10n_mx_edi_code_sat_id.code"
                                                        t-field="line.product_id.l10n_mx_edi_code_sat_id.code" /></td>
                                                <td class='border' name="account_invoice_line_name" style="width:400px">
                                                    <span t-field="line.product_id.name" /> <br/>
                                                    <t t-if="line.l10n_mx_edi_customs_number != 'False'">
                                                    <t t-foreach="line.l10n_mx_edi_customs_number.split(',') if line.l10n_mx_edi_customs_number else []"
                                                        t-as="pedimento">
                                                        <b>PED: <span t-esc="pedimento" /></b>
                                                    </t>
                                                    </t>
                                                     <t t-if="o.get_product_lot(line.product_id.id)">
                                                    <span t-esc="o.get_product_lot(line.product_id.id)" />
                                           
                                                        </t>


                                                    <table class="table_info" name="infor_adicional_line">
                                                        <thead>
                                                            <tr>
                                                                <td name="as_impuesto"><span
                                                                        class="letrafont">Impuesto</span></td>
                                                                <td name="as_tasa"><span class="letrafont">Tasa</span>
                                                                </td>
                                                                <td name="as_base"><span class="letrafont">Base</span>
                                                                </td>
                                                                <td name="as_impuesto"><span
                                                                        class="letrafont">Importe</span></td>

                                                            </tr>
                                                            <t t-foreach="o.get_tasa_xml(line.product_id.default_code)"
                                                                t-as="tax">
                                                                <tr>
                                                                    <td name="as_tax3"><span class="text2">
                                                                            <t t-esc="tax['Impuesto']" /></span>
                                                                    </td>
                                                                    <td name="as_tax"><span class="text2">
                                                                            <t t-esc="tax['Tasa']" /></span></td>
                                                                    <td name="as_tax2"><span class="text2">
                                                                            <t t-esc="tax['Base']"
                                                                                t-options='{"widget": "monetary", "display_currency": o.currency_id}' />
                                                                        </span></td>
                                                                    <td name="as_tax3"><span class="text2">
                                                                            <t t-esc="tax['Importe']"
                                                                                t-options='{"widget": "monetary", "display_currency": o.currency_id}' />
                                                                        </span></td>

                                                                </tr>
                                                            </t>
                                                        </thead>
                                                    </table>
                                                </td>
                                                <td class="text-right border">
                                                    <span t-esc="int(line.quantity)" />
                                                    <!-- <span t-field="line.product_uom_id" groups="uom.group_uom" /> -->
                                                </td>
                                                <td class='border'
                                                    t-attf-class="text-right {{ 'd-md-table-cell' if report_type == 'html' else '' }}">
                                                    <span t-field="line.price_unit"
                                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}' />
                                                </td>

                                                <td class="text-right o_price_total border">
                                                    <span t-field="line.price_subtotal"/>
                                                    <!-- <span t-field="line.price_total"
                                                        groups="account.group_show_line_subtotals_tax_included" /> -->
                                                </td>
                                            </t>

                                        </tr>

                                        <t
                                            t-if="current_section and (line_last or o.invoice_line_ids[line_index+1].display_type == 'line_section')">
                                            <tr class="is-subtotal text-right">
                                                <td colspan="99">
                                                    <strong class="mr16">Subtotal</strong>
                                                    <span t-esc="current_subtotal"
                                                        t-options='{"widget": "monetary", "display_currency": o.currency_id}' />
                                                </td>
                                            </tr>
                                        </t>
                                    </t>
                                    <tr>
                                        <td colspan="6">
                                            <div id="total" class="row">
                                                <div class="col-8">

                                                    <p class="header_table">
                                                        <t t-if="not o.l10n_mx_edi_amount_to_text()">
                                                            <b><span
                                                                    t-esc="o.company_id.currency_id.amount_to_text(o.amount_total)" /></b>
                                                        </t>
                                                        <t t-if="o.l10n_mx_edi_amount_to_text()">
                                                            <b><span style="padding:5px"
                                                                    t-esc="o.l10n_mx_edi_amount_to_text()" /></b>
                                                        </t>
                                                    </p>

                                                    <div id="total2" class="row">
                                                        <div class="col-5" style="text-align:right;">
                                                            <t t-if="o.l10n_mx_edi_cfdi_uuid">
                                                                <p class="letra"> <b>METODO DE PAGO:</b>
                                                                    <t
                                                                        t-esc="xml.get('formaDePago', xml.get('MetodoPago'))" />
                                                                </p>
                                                                <p class="letra"><b>FORMA DE PAGO:</b>
                                                                    <t t-esc="o.l10n_mx_edi_payment_method_id.code" />
                                                                </p>
                                                                <p class="letra"><b>USO DE CFDI:</b>
                                                                    <t t-esc="xml.Receptor.get('UsoCFDI', False)" />
                                                                </p>
                                                                <!-- <p class="letra"><b>VERSIÓN CFDI:</b>
                                                                    <t t-esc="tfd.get('Version')" />
                                                                </p> -->
                                                                <p class="letra"><b>MONEDA:</b>
                                                                    <t t-esc="o.currency_id.name" />
                                                                </p>
                                                            </t>
                                                        </div>
                                                        <div class="col-7">
                                                            <br />
                                                            <br />
                                                            <br />
                                                            <p class="letra" style="text-align:center;">
                                                                ___________________________________________<br />
                                                                Nombre, fecha y firma de recibido</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-4">
                                                    <table class="table table-sm o_main_table">
                                                        <tr class="o_subtotal" style="">
                                                            <td><strong class='letrafont'>Subtotal</strong></td>
                                                            <td class="text-right">
                                                                <b> <span class='letra'
                                                                        t-field="o.amount_untaxed" /></b>
                                                            </td>
                                                        </tr>
                                                        <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                                            <tr style="">
                                                                <t
                                                                    t-if="len(o.line_ids.filtered(lambda line: line.tax_line_id)) == 1 and o.amount_untaxed == amount_by_group[2]">
                                                                    <td><span class='letrafont'
                                                                            t-esc="amount_by_group[0]" /></td>
                                                                    <td class="text-right o_price_total">
                                                                        <b> <span class='letra'
                                                                                t-esc="amount_by_group[3]" /></b>
                                                                    </td>
                                                                </t>
                                                                <t t-else="">
                                                                    <td>
                                                                        <span t-esc="amount_by_group[0]" />
                                                                        <span>&amp;nbsp;<span>on</span>
                                                                            <t class='letrafont'
                                                                                t-esc="amount_by_group[4]" />
                                                                        </span>
                                                                    </td>
                                                                    <td class="text-right o_price_total">
                                                                        <b> <span class='letra'
                                                                                t-esc="amount_by_group[3]" /></b>
                                                                    </td>
                                                                </t>
                                                            </tr>
                                                        </t>
                                                        <tr class="border-black o_total">
                                                            <td><strong class='letrafont'>Total</strong></td>
                                                            <td class="text-right">
                                                                <b> <span class='letra' t-field="o.amount_total" /></b>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>

                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="6">
                                            <div class="parrafo2">
                                                <b>NOTA IMPORTANTE:</b> <b>
                                                    <t t-esc="o._onchange_terms()" /></b>
                                            </div>

                                        </td>
                                    </tr>
                                    <t t-if="o.l10n_mx_edi_cfdi_uuid">
                                        <tr>
                                            <td>


                                                <t t-set="sello" t-value="xml.get('Sello', 'No identificado')[-8:]" />
                                                <img alt="Barcode" t-att-src="'/report/barcode/?type=QR&amp;value=%s' % quote_plus(
                            'https://verificacfdi.facturaelectronica.sat.gob.mx/default.aspx?' + keep_query(
                                re=o.l10n_mx_edi_cfdi_supplier_rfc, rr=o.l10n_mx_edi_cfdi_customer_rfc,
                                tt=o.l10n_mx_edi_cfdi_amount, id=o.l10n_mx_edi_cfdi_uuid)
                                + '&amp;fe=%s' % quote_plus(
                                    sello, 'utf-8', 'strict', '=/').replace('%2B', '+'))"
                                                    style="width:145px;height:145px;margin:0px;padding:0px" />


                                            </td>

                                            <td colspan="5">
                                                <div class="parrafo22" id='complement3'>
                                                    <div class="digital-stamp" style="text-align:left !important;">
                                                        <span>Datos del Timbrado Fiscal</span>
                                                    </div>
                                                    <div class="digital-stamp-content">
                                                        <b>Sello del CFDi:</b><br />
                                                        <span
                                                            t-esc="xml.get('sello', xml.get('Sello', 'No identificado'))" />
                                                    </div>

                                                    <div class="digital-stamp-content">
                                                        <b>Sello del SAT:</b><br />
                                                        <span
                                                            t-esc="tfd.get('selloSAT', tfd.get('SelloSAT', 'No identificado'))" />
                                                    </div>

                                                    <div class="digital-stamp-content">
                                                        <b>Folio Fiscal:</b> <span t-esc="tfd.get('UUID')" /> |
                                                        <b>No. de serie de
                                                            certificado
                                                            SAT:</b>: <span t-esc="tfd.get('NoCertificadoSAT')" /> |
                                                        <b>Fecha de
                                                            Certificacion:</b>
                                                        <span
                                                            t-esc="xml.get('fecha', xml.get('Fecha', '')).replace('T', ' ')" />
                                                    </div>
                                                    <br />
                                                </div>


                                            </td>
                                        </tr>
                                    </t>
                                </tbody>

                            </table>

                        </div>

                    </t>
                    <t t-call="web.internal_layout">

                        <div class="footer" style="font-family: Helvetica Neue !important;">
                            <style>
                                html {
                                    margin: 0;
                                }

                                .parrafo {
                                    font-size: 12px;
                                    text-align: justify;
                                    line-height: 18px;
                                    background: #ccc;
                                    padding: 5px;
                                    line-height: 15px;
                                }

                                @font-face {
                                    font-family: 'Helvetica Neue';
                                    src: url('/as_sale_pricelist/static/Helvetica LT 57 Condensed.ttf') format('truetype');
                                    font-weight: normal;
                                    font-style: normal;
                                }

                                .parrafo2 {
                                    font-size: 12px;
                                    text-align: justify;
                                    line-height: 15px;
                                }

                                body {
                                    font-family: Helvetica Neue !important;
                                }

                                .letra {
                                    font-family: Helvetica Neue !important;
                                    font-size: 12px !important;
                                }

                                .letrafont {
                                    font-family: Helvetica Neue !important;
                                    font-size: 12px !important;
                                    color: #8c8c8c;
                                }

                                .letrablue {
                                    font-family: Helvetica Neue !important;
                                    font-size: 12px !important;
                                    color: #465f7a;
                                }

                                .class {
                                    text-align: left:
                                }
                            </style>

                            <div style="font-size:14px !important">
                                <b>
                                    <div style="color:#465f7a;">
                                        <t t-esc="o.company_id.name" style="color:#000000; !important" />
                                        | RFC:
                                        <t t-esc="o.company_id.vat" /> | <img width="18px" height="18px"
                                            src="/as_sale_pricelist/static/ubica.png" />
                                        <t t-esc="o.company_id.street" />,
                                        <t t-esc="o.company_id.l10n_mx_edi_locality" />
                                        <t t-esc="o.company_id.state_id.name" />| <img width="18px" height="18px"
                                            src="/as_sale_pricelist/static/phone.png" />
                                        <t icon="fa-phone" t-esc="o.company_id.phone" />
                                    </div>

                                </b>
                                <p style="float:right">Pág. <label class="page" />/<label class="topage" /></p>
                            </div>


                        </div>

                    </t>
                </t>
            </t>
        </template>
        <template id="report_invoice_print">
            <t t-call="web.html_container">

                <t t-foreach="docs" t-as="o">
                    <t t-set="lang"
                        t-value="o.invoice_user_id.lang if o.type in ('in_invoice', 'in_refund') else o.partner_id.lang" />

                    <t t-call="as_sale_pricelist.as_pdf_report_invoice" t-lang="lang" />

                </t>
            </t>
        </template>
    </data>
</odoo>